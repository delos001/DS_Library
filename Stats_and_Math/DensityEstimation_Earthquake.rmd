---
title: "Kernel Density Estimation Using Earthquake Magnitude Data"
output: word_document
---

The first portion of this program generates the vector of earthquake magnitudes 
and displays descriptive statistics for these data.  Necessary library packages
are also identified.

## Earthquake magnitude descriptive statistics

```{r}
mag <- c(0.70, 0.74, 0.64, 0.39, 0.70, 2.20, 1.98, 0.64, 1.22, 0.20, 1.64, 1.02, 
         2.95, 0.90, 1.76, 1.00, 1.05, 0.10, 3.45, 1.56, 1.62, 1.83, 0.99, 1.56,
         0.40, 1.28, 0.83, 1.24, 0.54, 1.44, 0.92, 1.00, 0.79, 0.79, 1.54, 1.00,
         2.24, 2.50, 1.79, 1.25, 1.49, 0.84, 1.42, 1.00, 1.25, 1.42, 1.15, 0.93,
         0.40, 1.39)

my_stats <- function(x) {
  cat("\n     mean:", mean(x, na.rm = TRUE))
  cat("\n   median:", median(x, na.rm = TRUE))
  cat("\n    range:", range(x))  
  cat("\n       sd:", sd(x, na.rm = TRUE))
  cat("\n variance:", var(x, na.rm = TRUE))
  cat("\n       Q1:", quantile(x, probs = c(0.25), na.rm = TRUE))
  cat("\n       Q3:", quantile(x, probs = c(0.75), na.rm = TRUE))
  cat("\n      P10:", quantile(x, probs = c(0.10), na.rm = TRUE),"\n")
}
my_stats(mag)

library(sROC)
```

## Kernel Density Estimation

Kernel density estimation is a non-parametric way to estimate the probability 
density function of a random variable. Kernel density estimation is a fundamental 
data smoothing procedure involving inferences about the population based on a 
data sample.  It is useful for enhancing displays, showing differences between
distributions and in some cases estimating quantiles.

## Use With Histograms

A kernel density estimate can be superimposed upon a histogram in base R.  To do 
this, it is necessary to scale the density estimate to reflect the class 
frequencies in the histogram.  A multiplier must be calculated and applied to the
kernel density estimate.  The object generated by hist() contains both counts and
density values which can be used.  Checking str() reveals this.

```{r , fig.show = 'hide'}
str(hist(mag))
multiplier <- mean(hist(mag, cells <- seq(from = 0.0, to = 3.5, by = 0.5),
                        right = FALSE)$counts/hist(mag)$density)
```
test <- hist(mag,cells <- seq(from = 0.0, to = 3.5, by = 0.5),right = FALSE)
There are different options for kernel density estimation that can be found using
the help function.  Checking the structure of the object generated shows the 
variable y which must be adjusted by the multiplier for scaling purposes.   

```{r, fig.show = 'hide'}
object <- density(mag,bw="nrd0",adjust=1,kernel=c("epanechnikov"),from=0,to=4)
str(object)
object$y <- object$y*multiplier
```

A histogram with the kernel density estimate superimposed may now be presented.
The kernel density estimate has been scaled to correspond to the frequencies
and superimposed on the histogram using base R.  Comparable displays may be
generated using ggplot2.

```{r}
plot(hist(mag, cells <- seq(from = 0.0, to = 3.5, by = 0.5),right = FALSE),
     ylim = c(0,20),xlab = c("Earthquake Magnitude"), ylab = c("Frequency"),
     main = "Histogram with Kernel Density Estimate")
lines(object, col = "blue", lwd = 2)
```

## Use with Cumulative Distribution Function

Another application is to superimpose an estimate of the cumulative distribution
function on a plot of the empirical distribution function.  There are various 
options which must be specified in the kCDF() function.  Checking the structure
of the resulting object helps to clarify the variables used for display.

```{r}
result <- kCDF(mag,from = 0,bw = "npdf",kernel=c("epanechnikov"),xgrid=mag)
str(result)
plot.ecdf(mag, col = "red", pch =16, xlab = "Earthquake Magnitudes", 
          main = "CDF of Earthquake Magnitudes"          )
lines(result$x,result$Fhat, col = "green", lwd = 2)
```
